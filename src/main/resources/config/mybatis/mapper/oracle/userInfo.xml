<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="config.mybatis.mapper.oracle.userInfo">
 	<select id="selectUserInfoSearch" parameterType="searchVo" resultType="hashmap">
		select *
		from
		(
		    select A.*, rownum as RNUM 
		    from
		    (
		        select * from user_infoView
		        <where>
				<if test="searchKeyword != null and searchKeyword != ''">
					${searchCondition} like '%' || #{searchKeyword} || '%'
				</if>
				<if test="searchUseYn=='OUT'">
					and outdate is not null
				</if>
				<if test="searchUseYn=='STAY'">
					and outdate is null
				</if>
				<if test="searchUseYn=='ACTIVATE'">
					and activation='Y'
				</if>
				<if test="searchUseYn=='NONACTIVATE'">
					and activation='N'
				</if>
				</where>
		    ) A
		)
		<![CDATA[ where RNUM>#{firstRecordIndex}  
		and RNUM<=#{firstRecordIndex} + #{recordCountPerPage}]]>
	</select>
	
	<select id="selectTotalCount" parameterType="searchVo" resultType="int">
		select count(*) from user_infoView
		<where>
			<if test="searchKeyword != null and searchKeyword != ''">
				${searchCondition} like '%' || #{searchKeyword} || '%'
			</if>
			<if test="searchUseYn=='OUT'">
				and outdate is not null
			</if>
			<if test="searchUseYn=='STAY'">
				and outdate is null
			</if>
			<if test="searchUseYn=='ACTIVATE'">
				and activation='Y'
			</if>
			<if test="searchUseYn=='NONACTIVATE'">
				and activation='N'
			</if>
		</where>	
	</select>
	
	<update id="memberInactiveByUserNo" parameterType="int">
		update user_info
		set activation='N'
		where user_no=#{userNo}
	</update>
	
	<update id="memberActiveByUserNo" parameterType="int">
		update user_info
		set activation='Y'
		where user_no=#{userNo}
	</update>
	
	<insert id="registUser" parameterType="userInfoVo">
		insert into user_info values
		(user_info_seq.nextval,#{userId},#{userPwd},#{userName},
		#{hp},#{zipcode},#{address},#{addressDetail},sysdate,null,'Y',
		(select author_no from authority where author_lev=6))
	</insert>
	
</mapper>